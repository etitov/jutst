language: java
jdk: openjdk11
script:
  - |
    echo "GO diff! "
    diff=$(git diff --name-only $TRAVIS_BRANCH...HEAD | awk -F/ '{print $1, $2}' | sort -u | grep task)
    count=`echo $diff | wc -w`
    echo "COUNT $count"
    if [ "$count" == "0" ];
    then
      echo "Nothing to check"
      exit 1
    fi
    if [ $count != 2 ];
    then
      echo "Only single task is allowed"
      exit 1
    fi
    slot=`echo $diff | cut -f1 -d' '`
    task=`echo $diff | cut -f2 -d' '`
    
    echo "SLOTTT $slot"
    if [ $slot == "08-java-io2" ]
    then
        echo "INSTALL"
        sudo add-apt-repository -y ppa:mc3man/trusty-media
        sudo apt-get -qq update
        sudo apt-get install -y ffmpeg
    fi
    echo "Checking $task"
    cmd="./gradlew :$task:clean :$task:check"
    cd $slot
    $cmd
